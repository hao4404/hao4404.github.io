# å·¥ä½œæµåç§°
name: ç›‘æµ‹index.htmlæ›´æ–°å¹¶æ¨é€é€šçŸ¥

# è§¦å‘æ¡ä»¶ï¼šä»…index.htmlæ›´æ–°æ—¶è§¦å‘
on:
  push:
    paths:
      - 'index.html'  # ç›‘æµ‹æ ¹ç›®å½•çš„index.htmlï¼Œå­ç›®å½•æ”¹è·¯å¾„å³å¯

jobs:
  send-notification:
    runs-on: ubuntu-latest
    steps:
      # æ‹‰å–ä»“åº“ä»£ç ï¼ˆå¯é€‰ï¼Œç”¨äºè·å–æäº¤ä¿¡æ¯ï¼‰
      - name: æ‹‰å–ä»“åº“ä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      # å‘é€é’‰é’‰é€šçŸ¥ï¼ˆæ ¸å¿ƒä¿®å¤éƒ¨åˆ†ï¼‰
      - name: å‘é€é’‰é’‰é€šçŸ¥
        env:
          # ä»Secretsè¯»å–é’‰é’‰Webhook
          DINGTALK_WEBHOOK: ${{ secrets.DINGTALK_WEBHOOK }}
          # è·å–æäº¤ç›¸å…³ä¿¡æ¯
          COMMIT_AUTHOR: ${{ github.actor }}
          COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
          COMMIT_URL: ${{ github.event.head_commit.url }}
          REPO_NAME: ${{ github.repository }}
        run: |
          # æ„é€ åˆæ³•çš„JSONå­—ç¬¦ä¸²ï¼ˆShellä¸­ç”¨åæ–œæ æ¢è¡Œï¼Œæ— +å·ï¼‰
          curl -X POST "${DINGTALK_WEBHOOK}" \
          -H "Content-Type: application/json" \
          -d '{
            "msgtype": "markdown",
            "markdown": {
              "title": "index.html æ›´æ–°é€šçŸ¥",
              "text": "### ğŸš¨ é™æ€ç½‘é¡µä¸»é¡µå·²æ›´æ–°\n\n**ä»“åº“åç§°**ï¼š'"${REPO_NAME}"'\n\n**æ›´æ–°ä½œè€…**ï¼š'"${COMMIT_AUTHOR}"'\n\n**æäº¤ä¿¡æ¯**ï¼š'"${COMMIT_MESSAGE}"'\n\n**æäº¤è¯¦æƒ…**ï¼š[ç‚¹å‡»æŸ¥çœ‹]('"${COMMIT_URL}"')\n\n**æ›´æ–°æ–‡ä»¶**ï¼šindex.html"
            },
            "at": {
              "isAtAll": false
            }
          }'
