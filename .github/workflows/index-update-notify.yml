# å·¥ä½œæµåç§°ï¼Œä¼šæ˜¾ç¤ºåœ¨ GitHub Actions é¢æ¿ä¸­
name: ç›‘æµ‹index.htmlæ›´æ–°å¹¶æ¨é€é€šçŸ¥

# è§¦å‘æ¡ä»¶ï¼šåªæœ‰å½“ push æ“ä½œä¿®æ”¹äº†æ ¹ç›®å½•çš„ index.html æ–‡ä»¶æ—¶ï¼Œæ‰è§¦å‘è¿™ä¸ªå·¥ä½œæµ
on:
  push:
    paths:
      - 'index.html'  # åªç›‘æµ‹æ ¹ç›®å½•çš„ index.html æ–‡ä»¶å˜æ›´ï¼Œå­ç›®å½•å¯å†™å¦‚ 'src/index.html'

# è¦æ‰§è¡Œçš„ä½œä¸š
jobs:
  send-notification:
    # è¿è¡Œç¯å¢ƒï¼šä½¿ç”¨ GitHub æä¾›çš„ Ubuntu è™šæ‹Ÿæœº
    runs-on: ubuntu-latest
    
    # æ‰§è¡Œæ­¥éª¤
    steps:
      # æ­¥éª¤1ï¼šæ‹‰å–ä»“åº“ä»£ç ï¼ˆå¯é€‰ï¼Œä½†å»ºè®®åŠ ï¼Œæ–¹ä¾¿è·å–æäº¤ä¿¡æ¯ï¼‰
      - name: æ‹‰å–ä»“åº“ä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 2  # æ‹‰å–æœ€è¿‘2æ¬¡æäº¤ï¼Œç”¨äºå¯¹æ¯”æ–‡ä»¶å˜æ›´

      # æ­¥éª¤2ï¼šå‘é’‰é’‰æ¨é€é€šçŸ¥
      - name: å‘é€é’‰é’‰é€šçŸ¥
        env:
          # ä»ä»“åº“ Secrets ä¸­è¯»å–é’‰é’‰ Webhook åœ°å€
          DINGTALK_WEBHOOK: ${{ secrets.DINGTALK_WEBHOOK }}
          # è·å–æäº¤ä½œè€…ã€ä¿¡æ¯ã€æäº¤å“ˆå¸Œç­‰å…³é”®ä¿¡æ¯
          COMMIT_AUTHOR: ${{ github.actor }}
          COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
          COMMIT_URL: ${{ github.event.head_commit.url }}
          REPO_NAME: ${{ github.repository }}
        run: |
          # æ„é€ é’‰é’‰é€šçŸ¥çš„ JSON å†…å®¹
          curl -X POST $DINGTALK_WEBHOOK \
          -H "Content-Type: application/json" \
          -d '{
            "msgtype": "markdown",
            "markdown": {
              "title": "index.html æ›´æ–°é€šçŸ¥",
              "text": "### ğŸš¨ é™æ€ç½‘é¡µä¸»é¡µå·²æ›´æ–°\n\n" +
                      "**ä»“åº“åç§°**ï¼š'"$REPO_NAME"'\n\n" +
                      "**æ›´æ–°ä½œè€…**ï¼š'"$COMMIT_AUTHOR"'\n\n" +
                      "**æäº¤ä¿¡æ¯**ï¼š'"$COMMIT_MESSAGE"'\n\n" +
                      "**æäº¤è¯¦æƒ…**ï¼š[ç‚¹å‡»æŸ¥çœ‹]('"$COMMIT_URL"')\n\n" +
                      "**æ›´æ–°æ–‡ä»¶**ï¼šindex.html"
            },
            "at": {
              "isAtAll": false  # æ˜¯å¦@æ‰€æœ‰äººï¼Œfalse åˆ™åªæ¨é€æ¶ˆæ¯ï¼Œtrue ä¼š@ç¾¤é‡Œæ‰€æœ‰äºº
            }
          }'
