<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haoã®ç¾é£Ÿåœ°å›¾</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: "Microsoft Yahei", sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        /* å·¦ä¾§åˆ—è¡¨å®¹å™¨ */
        .list-container {
            width: 380px;
            padding: 20px;
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
            overflow-y: auto;
        }
        .list-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
            font-weight: bold;
        }
        .stats-container {
            background: white;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .stats-title {
            font-size: 14px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .progress-bar {
            height: 24px;
            background: #f0f0f0;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            margin-bottom: 8px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #52c41a, #73d13d);
            border-radius: 12px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        .stats-detail {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
        }
        .stats-visited {
            color: #52c41a;
        }
        .stats-unvisited {
            color: #ff4d4f;
        }
        .food-list {
            list-style: none;
        }
        .food-item {
            background: white;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        .food-item.visited {
            border-left: 4px solid #52c41a;
        }
        .food-item.unvisited {
            border-left: 4px solid #ff4d4f;
        }
        .food-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-color: #0091ff;
        }
        .food-item-name {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        .food-item-address {
            font-size: 13px;
            color: #666;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
        }
        .food-item-food {
            font-size: 13px;
            color: #666;
        }
        .food-item-icon {
            margin-right: 6px;
        }
        .food-item-status {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
        }
        .food-item-status.visited {
            background: #f6ffed;
            color: #52c41a;
            border: 1px solid #b7eb8f;
        }
        .food-item-status.unvisited {
            background: #fff1f0;
            color: #ff4d4f;
            border: 1px solid #ffa39e;
        }
        /* å³ä¾§åœ°å›¾å®¹å™¨ */
        .map-container {
            flex: 1;
            height: 100vh;
            min-width: 300px;
        }
        /* æ— æ•°æ®æç¤º */
        .no-data {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- å·¦ä¾§ç¾é£Ÿåˆ—è¡¨ -->
    <div class="list-container">
        <h3 class="list-title">Haoã®ç¾é£Ÿåœ°å›¾</h3>
        <div class="stats-container">
            <div class="stats-title">ğŸ“Š æ¢åº—è¿›åº¦</div>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill" style="width: 0%">0%</div>
            </div>
            <div class="stats-detail">
                <span class="stats-visited">âœ… å·²å»è¿‡: <span id="visitedCount">0</span></span>
                <span class="stats-unvisited">âŒ æœªå»: <span id="unvisitedCount">0</span></span>
            </div>
        </div>
        <ul id="foodList" class="food-list"></ul>
    </div>

    <!-- å³ä¾§åœ°å›¾å®¹å™¨ -->
    <div id="map" class="map-container"></div>

    <script type="text/javascript">
        // ==================== é…ç½®åŒºåŸŸ ====================
        const AMAP_CONFIG = {
            securityJsCode: '0a12f15c96b7cc2513e09ca71f7b0915',
            apiKey: 'c1847c6d19b569629a3d73eab136e9f1',
            defaultCenter: [114.2707, 30.5928], // æ­¦æ±‰å¸‚æ±Ÿæ±‰åŒºä¸­å¿ƒåæ ‡
            defaultZoom: 14
        };

        // ==================== ç¾é£Ÿæ•°æ®é…ç½®åŒºåŸŸ ====================
        // åœ¨è¿™é‡Œæ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹ç¾é£Ÿç‚¹ä½
        const FOOD_LOCATIONS = [
            {
                name: "è”¡æ—è®°",
                address: "æ±Ÿæ±‰åŒºæ±Ÿæ±‰è·¯æ­¥è¡Œè¡—",
                food: "çƒ­å¹²é¢ã€è±†çš®",
                lng: 114.2908,
                lat: 30.5785,
                visited: true  // true=å»è¿‡, false=æ²¡å»è¿‡
            },
            {
                name: "å››å­£ç¾",
                address: "æ±Ÿæ±‰åŒºä¸­å±±å¤§é“",
                food: "æ±¤åŒ…",
                lng: 114.2856,
                lat: 30.5823,
                visited: false
            },
            {
                name: "äº”èŠ³æ–‹",
                address: "æ±Ÿæ±‰åŒºæ–°åè·¯",
                food: "æ±¤åœ†ã€ç²½å­",
                lng: 114.2754,
                lat: 30.5956,
                visited: false
            }
        ];

        // ==================== ä»£ç åŒºåŸŸï¼ˆæ— éœ€ä¿®æ”¹ï¼‰ ====================
        let map, markers = [];

        // åŠ¨æ€åŠ è½½é«˜å¾·åœ°å›¾API
        function loadAMap() {
            window._AMapSecurityConfig = {
                securityJsCode: AMAP_CONFIG.securityJsCode
            };
            const script = document.createElement('script');
            script.src = `https://webapi.amap.com/maps?v=2.0&key=${AMAP_CONFIG.apiKey}`;
            script.onload = initMap;
            script.onerror = function() {
                alert('é«˜å¾·åœ°å›¾APIåŠ è½½å¤±è´¥ï¼è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            };
            document.body.appendChild(script);
        }

        // åˆå§‹åŒ–åœ°å›¾
        function initMap() {
            try {
                map = new AMap.Map('map', {
                    zoom: AMAP_CONFIG.defaultZoom,
                    center: AMAP_CONFIG.defaultCenter,
                    resizeEnable: true,
                    mapStyle: 'amap://styles/normal'
                });

                // åœ°å›¾åŠ è½½å®Œæˆåæ·»åŠ æ ‡è®°
                map.on('complete', function() {
                    console.log('âœ… åœ°å›¾åŠ è½½æˆåŠŸï¼');
                    renderFoodMap();
                });
            } catch (e) {
                alert('åœ°å›¾åˆå§‹åŒ–å¤±è´¥ï¼š' + e.message);
                console.error('åˆå§‹åŒ–é”™è¯¯è¯¦æƒ…ï¼š', e);
            }
        }

        // æ¸²æŸ“ç¾é£Ÿåœ°å›¾å’Œåˆ—è¡¨
        function renderFoodMap() {
            // æ¸…ç©ºä¹‹å‰çš„æ ‡è®°å’Œåˆ—è¡¨
            markers.forEach(m => m.marker.setMap(null));
            markers = [];

            // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
            const total = FOOD_LOCATIONS.length;
            const visited = FOOD_LOCATIONS.filter(item => item.visited).length;
            const unvisited = total - visited;
            const percentage = total > 0 ? Math.round((visited / total) * 100) : 0;

            // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
            document.getElementById('visitedCount').textContent = visited;
            document.getElementById('unvisitedCount').textContent = unvisited;
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressFill').textContent = percentage + '%';

            if (FOOD_LOCATIONS.length === 0) {
                document.getElementById('foodList').innerHTML = '<div class="no-data">æš‚æ— ç¾é£Ÿæ•°æ®</div>';
                return;
            }

            // æ¸²æŸ“å·¦ä¾§åˆ—è¡¨å’Œåœ°å›¾æ ‡è®°
            const listHtml = FOOD_LOCATIONS.map((item, index) => {
                createMarker(item, index);
                const statusClass = item.visited ? 'visited' : 'unvisited';
                const statusText = item.visited ? 'âœ… å·²å»è¿‡' : 'âŒ æœªå»';
                const statusLabelClass = item.visited ? 'visited' : 'unvisited';

                return `
                    <li class="food-item ${statusClass}" onclick="panToMarker(${index})">
                        <div class="food-item-status ${statusLabelClass}">${statusText}</div>
                        <div class="food-item-name">${item.name}</div>
                        <div class="food-item-address">
                            <span class="food-item-icon">ğŸ“</span>${item.address}
                        </div>
                        <div class="food-item-food">
                            <span class="food-item-icon">ğŸœ</span>${item.food}
                        </div>
                    </li>
                `;
            }).join('');

            document.getElementById('foodList').innerHTML = listHtml;
        }

        // åˆ›å»ºåœ°å›¾æ ‡è®°
        function createMarker(item, index) {
            // ä½¿ç”¨é£Ÿç‰©emojiä½œä¸ºæ ‡è®°
            const foodIcon = 'ğŸœ';

            const marker = new AMap.Marker({
                position: [item.lng, item.lat],
                title: item.name,
                content: `<div style="
                    font-size: 32px;
                    line-height: 1;
                    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
                    cursor: pointer;
                    transition: transform 0.2s;
                ">${foodIcon}</div>`,
                anchor: 'center',
                offset: new AMap.Pixel(0, 0)
            });

            const infoWindow = new AMap.InfoWindow({
                content: `
                    <div style="padding: 10px; font-size: 14px; min-width: 200px;">
                        <h4 style="margin-bottom: 8px; color: #0091ff;">${item.name}</h4>
                        <p style="margin: 5px 0; color: #666;">ğŸ“ ${item.address}</p>
                        <p style="margin: 5px 0; color: #666;">ğŸœ ${item.food}</p>
                    </div>
                `,
                offset: new AMap.Pixel(0, -30)
            });

            marker.on('click', function() {
                infoWindow.open(map, marker.getPosition());
            });

            marker.on('mouseover', function() {
                const content = marker.getContent();
                if (content && content.tagName === 'DIV') {
                    content.style.transform = 'scale(1.2)';
                }
            });

            marker.on('mouseout', function() {
                const content = marker.getContent();
                if (content && content.tagName === 'DIV') {
                    content.style.transform = 'scale(1)';
                }
            });

            marker.addTo(map);
            markers.push({ marker, infoWindow, index });
        }

        // ç‚¹å‡»åˆ—è¡¨é¡¹å®šä½åˆ°å¯¹åº”æ ‡è®°
        function panToMarker(index) {
            if (markers[index]) {
                const { marker, infoWindow } = markers[index];
                map.setCenter(marker.getPosition());
                map.setZoom(16);
                infoWindow.open(map, marker.getPosition());
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        window.onload = loadAMap;
    </script>
</body>
</html>